<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语音测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            padding: 15px 30px;
            margin: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
        #voiceList {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>语音测试工具</h1>
        
        <div class="test-section">
            <h3>1. 显示所有可用语音</h3>
            <button onclick="listVoices()">列出所有语音</button>
            <div id="voiceList"></div>
        </div>
        
        <div class="test-section">
            <h3>2. 基础语音测试</h3>
            <button onclick="testBasic()">测试基础语音</button>
        </div>
        
        <div class="test-section">
            <h3>3. 泰语测试</h3>
            <button onclick="testThai1()">测试泰语 (th)</button>
            <button onclick="testThai2()">测试泰语 (th-TH)</button>
            <button onclick="testThai3()">测试泰语 (无语言设置)</button>
        </div>
        
        <div class="test-section">
            <h3>4. 中文测试</h3>
            <button onclick="testChinese1()">测试中文 (zh)</button>
            <button onclick="testChinese2()">测试中文 (zh-CN)</button>
        </div>
        
        <div class="test-section">
            <h3>5. 设备信息</h3>
            <button onclick="showDeviceInfo()">显示设备信息</button>
            <div id="deviceInfo"></div>
        </div>
    </div>

    <script>
        let voices = [];
        
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            console.log('加载了', voices.length, '个语音');
        }
        
        // 页面加载时和语音变化时加载语音
        loadVoices();
        speechSynthesis.onvoiceschanged = loadVoices;
        
        function listVoices() {
            loadVoices();
            const voiceList = document.getElementById('voiceList');
            if (voices.length === 0) {
                voiceList.innerHTML = '没有找到可用语音，请稍后再试...';
                setTimeout(listVoices, 1000);
                return;
            }
            
            let html = `找到 ${voices.length} 个语音：<br><br>`;
            voices.forEach((voice, index) => {
                html += `${index + 1}. ${voice.name} (${voice.lang}) - ${voice.localService ? '本地' : '远程'}<br>`;
            });
            voiceList.innerHTML = html;
        }
        
        function speak(text, lang, voiceIndex = null) {
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            if (lang) utterance.lang = lang;
            if (voiceIndex !== null && voices[voiceIndex]) {
                utterance.voice = voices[voiceIndex];
            }
            
            utterance.onstart = () => console.log(`开始播放: ${text} (${lang || '默认'})`);
            utterance.onend = () => console.log(`播放完成: ${text}`);
            utterance.onerror = (e) => console.error(`播放错误: ${e.error} - ${text}`);
            
            speechSynthesis.speak(utterance);
        }
        
        function testBasic() {
            speak('Hello World', 'en-US');
        }
        
        function testThai1() {
            speak('สวัสดี', 'th');
        }
        
        function testThai2() {
            speak('สวัสดี', 'th-TH');
        }
        
        function testThai3() {
            speak('สวัสดี');
        }
        
        function testChinese1() {
            speak('你好', 'zh');
        }
        
        function testChinese2() {
            speak('你好', 'zh-CN');
        }
        
        function showDeviceInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages,
                speechSynthesis: !!window.speechSynthesis,
                voicesLength: voices.length
            };
            
            document.getElementById('deviceInfo').innerHTML = 
                '<pre>' + JSON.stringify(info, null, 2) + '</pre>';
        }
        
        // 用户交互激活
        document.addEventListener('click', () => {
            if (window.AudioContext) {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                if (ctx.state === 'suspended') {
                    ctx.resume();
                }
            }
        }, { once: true });
    </script>
</body>
</html>